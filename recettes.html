<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recettes - Cuisine Saine Sans Gluten et Sans Lactose</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Montserrat:wght@300;400&family=Sawarabi+Mincho&display=swap" rel="stylesheet">
  <style>
    html { scroll-behavior: smooth; }
    body { font-family: 'Montserrat', sans-serif; background-color: #F0EDE5; color: #4A4A4A; margin: 0; padding: 0; background-image: linear-gradient(rgba(255,255,255,0.3), rgba(255,255,255,0.3)), url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"%3E%3Cpath fill="%236B3A1E" fill-opacity="0.05" d="M11.5 0L0 11.5V100h100V0z"/%3E%3C/svg%3E'); }
    h1, h3, h4 { font-family: 'Dancing Script', cursive; color: #6B3A1E; line-height: 1.2; margin: 0; padding: 10px 0; }
    h2 { font-family: 'Dancing Script', cursive; font-size: 1.6em; line-height: 2.0; letter-spacing: 0.1em; font-style: normal; font-weight: 700; color: #000000; margin: 0; text-transform: uppercase; padding: 15px 0; }
    .navbar { background-color: #8B4513 !important; margin: 0; padding: 10px 0; }
    .navbar-brand, .nav-link { color: #F0EDE5 !important; font-weight: 300; }
    .nav-link:hover { color: #6B3A1E !important; }
    header { background: linear-gradient(to bottom, #8B4513, #F0EDE5); text-align: center; padding: 30px 0; margin: 0; }
    main { padding: 20px 0; margin: 0; }
    .introduction, .conclusion { text-align: center; padding: 20px; font-style: italic; }
    .card { transition: transform 0.3s ease; padding: 10px; }
    .card:hover { transform: scale(1.05); }
    .card-img-top { height: 200px; object-fit: cover; }
    .row { gap: 20px; padding: 0 10px; }
    #recipe-content { max-width: 800px; margin: 20px auto; padding: 20px; background-color: rgba(255,255,255,0.8); border-radius: 15px; display: none; }
    .back-button { text-align: center; padding: 20px 0; }
    .btn-brown { background-color: #6B3A1E; color: #F0EDE5; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; margin: 10px; }
    .btn-brown:hover { background-color: #8B4513; }
    .tip { background: #FFF3E0; padding: 10px; border-left: 5px solid #FF9800; border-radius: 8px; margin-top: 10px; }
    .health { background: #E8F5E9; padding: 10px; border-left: 5px solid #4CAF50; border-radius: 8px; margin-top: 10px; }
    .error-message { background: #ffebee; border: 2px solid #ef5350; padding: 20px; margin: 20px; border-radius: 10px; text-align: center; color: #c62828; }
    .loading { text-align: center; padding: 40px; font-size: 1.2em; color: #6B3A1E; }
  </style>
</head>
<body>

  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">Cuisine Saine Sans Gluten et Sans Lactose</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Accueil</a></li>
          <li class="nav-item"><a class="nav-link" href="recettes.html">Recettes</a></li>
          <li class="nav-item"><a class="nav-link" href="fodmap.html">Méthode FODMAP</a></li>
          <li class="nav-item"><a class="nav-link" href="achats.html">Achats</a></li>
          <li class="nav-item"><a class="nav-link" href="questions.html">Questions/Commentaires</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <header>
    <h1>Nos Recettes</h1>
    <p>Sans gluten, sans lactose & sans viande rouge</p>
  </header>

  <main class="container-fluid">
    <section class="introduction">
      <p>Une collection simple de recettes riches en nutriments, faciles à préparer et adaptées aux repas quotidiens pour allier plaisir, gourmandise et santé.</p>
    </section>

    <!-- Message de chargement -->
    <div id="loading" class="loading">Chargement des recettes...</div>

    <!-- Message d'erreur (caché par défaut) -->
    <div id="error-message" class="error-message" style="display: none;">
      <h3>⚠️ Erreur de chargement</h3>
      <p>Impossible de charger le fichier recettes.json. Veuillez vérifier que le fichier existe dans le même dossier que cette page.</p>
    </div>

    <!-- Niveau 1 : Catégories (2 colonnes format) -->
    <section id="categories-container" class="row row-cols-1 row-cols-md-2"></section>

    <!-- Niveau 2 : Recettes d'une catégorie (2 colonnes format) -->
    <section id="recipes-container" style="display: none;"></section>

    <!-- Niveau 3 : Détail d'une recette -->
    <section id="recipe-content" style="display: none;"></section>

    <section class="conclusion">
      <p>Ces recettes démontrent qu'une cuisine saine peut être élégante et gourmande. Régalez-vous !</p>
    </section>
  </main>

  <footer style="text-align: center; padding: 20px; background-color: #8B4513; color: #F0EDE5;">
    <p>&copy; 2023. Avec amour pour votre bien-être.</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Variables globales
    let recipesData = null;
    const catContainer = document.getElementById('categories-container');
    const recContainer = document.getElementById('recipes-container');
    const recipeDiv = document.getElementById('recipe-content');

    document.addEventListener("DOMContentLoaded", () => {
      // Charger le fichier JSON
      fetch('recettes.json')
        .then(response => {
          if (!response.ok) {
            throw new Error('Fichier recettes.json introuvable');
          }
          return response.json();
        })
        .then(data => {
          recipesData = data;
          document.getElementById('loading').style.display = 'none';
          showCategories();
        })
        .catch(error => {
          console.error('Erreur lors du chargement:', error);
          document.getElementById('loading').style.display = 'none';
          document.getElementById('error-message').style.display = 'block';
        });
    });

    // Afficher catégories (2 colonnes)
    function showCategories() {
      if (!recipesData || !recipesData.recipes) return;
        
        const categories = [...new Set(recipesData.recipes.map(r => r.category))];
        catContainer.innerHTML = "";
        recContainer.style.display = "none";
        recipeDiv.style.display = "none";
        catContainer.classList.add('row', 'row-cols-1', 'row-cols-md-2');
        
        categories.forEach(cat => {
          let imageUrl = `https://via.placeholder.com/400x200?text=${encodeURIComponent(cat)}`;
          if (cat === "Boissons gourmandes") {
            imageUrl = "brevage.png";
          } else if (cat === "Desserts raffinés") {
            imageUrl = "dessertsalle.png";
          }

          catContainer.innerHTML += `
            <div class="col">
              <div class="card h-100 shadow-sm">
                <img src="${imageUrl}" class="card-img-top" alt="${cat}">
                <div class="card-body text-center">
                  <h5 class="card-title">${cat}</h5>
                  <button class="btn btn-brown" onclick="showRecipes('${cat}')">Voir les recettes</button>
                </div>
              </div>
            </div>`;
        });
      }

      // Afficher recettes (2 colonnes)
      window.showRecipes = function(category) {
        if (!recipesData || !recipesData.recipes) return;
        
        catContainer.innerHTML = "";
        recipeDiv.style.display = "none";
        recContainer.style.display = "block";
        recContainer.innerHTML = `<h3 class="mt-3">${category}</h3><div class="row row-cols-1 row-cols-md-2 g-4">`;
        
        recipesData.recipes.forEach((r, i) => {
          if (r.category === category) {
            recContainer.innerHTML += `
              <div class="col">
                <div class="card h-100 shadow-sm">
                  <img src="https://via.placeholder.com/300x160?text=${encodeURIComponent(r.title)}" alt="${r.title}" class="card-img-top">
                  <div class="card-body">
                    <h5 class="card-title">${r.title}</h5>
                    <button class="btn btn-brown" onclick="showRecipe(${i})">Voir les détails</button>
                  </div>
                </div>
              </div>`;
          }
        });
        
        recContainer.innerHTML += `</div><div class="back-button"><button class="btn btn-brown" onclick="showCategories()">Retour aux catégories</button></div>`;
      };

      // Afficher détail recette
      window.showRecipe = function(index) {
        if (!recipesData || !recipesData.recipes) return;
        
        const r = recipesData.recipes[index];
        recContainer.style.display = "none";
        recipeDiv.style.display = "block";
        
        let ingredientsHTML = '<h4>Ingrédients</h4>';
        if (Array.isArray(r.ingredients)) {
          ingredientsHTML += `<ul>${r.ingredients.map(ing => `<li>${ing}</li>`).join('')}</ul>`;
        } else if (typeof r.ingredients === 'object' && r.ingredients !== null) {
          for (const part in r.ingredients) {
            ingredientsHTML += `<h5>${part.charAt(0).toUpperCase() + part.slice(1)}</h5><ul>${r.ingredients[part].map(ing => `<li>${ing}</li>`).join('')}</ul>`;
          }
        }

        let bienfaitsHTML = '';
        if (r.bienfaits) {
          bienfaitsHTML = '<div class="health"><h4>Bienfaits</h4><ul>';
          for (const key in r.bienfaits) {
            bienfaitsHTML += `<li><strong>${key.replace(/_/g, ' ')}:</strong> ${r.bienfaits[key]}</li>`;
          }
          bienfaitsHTML += '</ul></div>';
        }

        recipeDiv.innerHTML = `
          <div class="card">
            <div class="card-body">
              <h3>${r.title}</h3>
              <p>Catégorie: ${r.category}</p>
              ${r.portion ? `<p>Portions: ${r.portion}</p>` : ''}
              ${ingredientsHTML}
              <h4>Préparation</h4>
              <ol>${r.preparation.map(step => `<li>${step}</li>`).join('')}</ol>
              ${r.astuce ? `<div class="tip"><h4>Astuce</h4><p>${r.astuce}</p></div>` : ''}
              ${bienfaitsHTML}
            </div>
          </div>
          <div class="back-button">
            <button class="btn btn-brown" onclick="showRecipes('${r.category}')">Retour aux recettes</button>
            <button class="btn btn-brown" onclick="showCategories()">Retour aux catégories</button>
          </div>
        `;
      };

      // Rendre showCategories accessible globalement
      window.showCategories = showCategories;
    });
  </script>
</body>
</html>
