<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recettes - Cuisine Saine Sans Gluten et Sans Lactose</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Montserrat:wght@300;400&family=Sawarabi+Mincho&display=swap" rel="stylesheet">
  <style>
    html { scroll-behavior: smooth; }
    body { font-family: 'Montserrat', sans-serif; background-color: #F0EDE5; color: #4A4A4A; margin: 0; padding: 0; background-image: linear-gradient(rgba(255,255,255,0.3), rgba(255,255,255,0.3)), url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"%3E%3Cpath fill="%236B3A1E" fill-opacity="0.05" d="M11.5 0L0 11.5V100h100V0z"/%3E%3C/svg%3E'); }
    h1, h3, h4 { font-family: 'Dancing Script', cursive; color: #6B3A1E; line-height: 1.2; margin: 0; padding: 10px 0; }
    h2 { font-family: 'Dancing Script', cursive; font-size: 1.6em; line-height: 2.0; letter-spacing: 0.1em; font-style: normal; font-weight: 700; color: #000000; margin: 0; text-transform: uppercase; padding: 15px 0; }
    .navbar { background-color: #8B4513 !important; margin: 0; padding: 10px 0; }
    .navbar-brand, .nav-link { color: #F0EDE5 !important; font-weight: 300; }
    .nav-link:hover { color: #6B3A1E !important; }
    header { background: linear-gradient(to bottom, #8B4513, #F0EDE5); text-align: center; padding: 30px 0; margin: 0; }
    main { padding: 20px 0; margin: 0; }
    .introduction, .conclusion { text-align: center; padding: 20px; font-style: italic; }
    .card { transition: transform 0.3s ease; padding: 10px; }
    .card:hover { transform: scale(1.05); }
    .card-img-top { height: 200px; object-fit: cover; }
    .row { gap: 20px; padding: 0 10px; }
    #recipe-content { max-width: 800px; margin: 20px auto; padding: 20px; background-color: rgba(255,255,255,0.8); border-radius: 15px; display: none; }
    .back-button { text-align: center; padding: 20px 0; }
    .btn-brown { background-color: #6B3A1E; color: #F0EDE5; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; margin: 10px; }
    .btn-brown:hover { background-color: #8B4513; }
    .tip { background: #FFF3E0; padding: 10px; border-left: 5px solid #FF9800; border-radius: 8px; margin-top: 10px; }
    .health { background: #E8F5E9; padding: 10px; border-left: 5px solid #4CAF50; border-radius: 8px; margin-top: 10px; }
    .error-message { background: #ffebee; border: 2px solid #ef5350; padding: 20px; margin: 20px; border-radius: 10px; text-align: center; color: #c62828; }
    .loading { text-align: center; padding: 40px; font-size: 1.2em; color: #6B3A1E; }
  </style>
</head>
<body>

  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">Cuisine Saine Sans Gluten et Sans Lactose</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Accueil</a></li>
          <li class="nav-item"><a class="nav-link" href="recettes.html">Recettes</a></li>
          <li class="nav-item"><a class="nav-link" href="fodmap.html">Méthode FODMAP</a></li>
          <li class="nav-item"><a class="nav-link" href="achats.html">Achats</a></li>
          <li class="nav-item"><a class="nav-link" href="questions.html">Questions/Commentaires</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <header>
    <h1>Nos Recettes</h1>
    <p>Sans gluten, sans lactose & sans viande rouge</p>
  </header>

  <main class="container-fluid">
    <section class="introduction">
      <p>Une collection simple de recettes riches en nutriments, faciles à préparer et adaptées aux repas quotidiens pour allier plaisir, gourmandise et santé.</p>
    </section>

        <div id="loading" class="loading">Chargement des recettes...</div>

        <div id="error-message" class="error-message" style="display: none;">
      <h3>⚠️ Erreur de chargement</h3>
      <p>Impossible de charger ou d'interpréter les données de recettes. Vérifiez la console pour plus de détails sur la structure du fichier `recettes.json`.</p>
    </div>

        <section id="categories-container" class="row row-cols-1 row-cols-md-2 g-4"></section>

        <section id="recipes-container" style="display: none;"></section>

        <section id="recipe-content" style="display: none;"></section>

    <section class="conclusion">
      <p>Ces recettes démontrent qu'une cuisine saine peut être élégante et gourmande. Régalez-vous !</p>
    </section>
  </main>

  <footer style="text-align: center; padding: 20px; background-color: #8B4513; color: #F0EDE5;">
    <p>&copy; 2023. Avec amour pour votre bien-être.</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Variables globales
    let recipesData = null; // Contiendra l'objet JSON complet
    let sortedThemes = []; // Contiendra la liste des thèmes triés pour la navigation
    
    const catContainer = document.getElementById('categories-container');
    const recContainer = document.getElementById('recipes-container');
    const recipeDiv = document.getElementById('recipe-content');
    const RECIPE_FILE = 'recettes.json'; 

    // Charger le fichier JSON au chargement de la page
    document.addEventListener("DOMContentLoaded", () => {
      fetch(RECIPE_FILE)
        .then(response => {
          if (!response.ok) {
            // Ceci attrape une erreur 404/403/etc.
            throw new Error(`Fichier ${RECIPE_FILE} introuvable ou erreur de réseau.`);
          }
          return response.json();
        })
        .then(data => {
          recipesData = data;
          console.log("✅ Données JSON chargées :", recipesData); // VERIFIEZ CECI !
          
          document.getElementById('loading').style.display = 'none';
          
          // Trier les thèmes par ordre alphabétique pour la navigation
          if (recipesData && Array.isArray(recipesData.themes) && recipesData.themes.length > 0) {
            sortedThemes = [...recipesData.themes].sort((a, b) => 
              a.theme.localeCompare(b.theme, 'fr')
            );
            showCategories();
          } else {
            // Erreur silencieuse d'accès aux données.
            throw new Error("La clé 'themes' est manquante, vide ou n'est pas un tableau.");
          }
        })
        .catch(error => {
          console.error('Erreur fatale lors du traitement:', error);
          document.getElementById('loading').style.display = 'none';
          document.getElementById('error-message').style.display = 'block';
          // Afficher l'erreur dans le message d'erreur si possible
          document.querySelector('#error-message p').textContent = `Erreur: ${error.message}. Vérifiez le fichier ${RECIPE_FILE}.`;
        });
    });

    // Afficher catégories (2 colonnes) - triées alphabétiquement
    function showCategories() {
      catContainer.style.display = "flex";
      recContainer.style.display = "none";
      recipeDiv.style.display = "none";
      catContainer.innerHTML = "";
      
      sortedThemes.forEach((themeObj, index) => {
        const themeName = themeObj.theme;
        const recipeCount = themeObj.recettes.length; 
        
        let imageUrl = `https://via.placeholder.com/400x200?text=${encodeURIComponent(themeName)}`;
        
        if (themeName.includes("Desserts")) {
          imageUrl = "dessertsalle.png"; 
        } else if (themeName.includes("Soupes")) {
          imageUrl = "soupe.png"; 
        }

        catContainer.innerHTML += `
          <div class="col">
            <div class="card h-100 shadow-sm">
              <img src="${imageUrl}" class="card-img-top" alt="${themeName}">
              <div class="card-body text-center">
                <h5 class="card-title">${themeName}</h5>
                <p class="text-muted">${recipeCount} recette${recipeCount > 1 ? 's' : ''}</p>
                <button class="btn btn-brown" onclick="showRecipes(${index})">Voir les recettes</button>
              </div>
            </div>
          </div>`;
      });
    }

    // Afficher recettes d'un thème (2 colonnes)
    function showRecipes(themeIndex) {
      if (!sortedThemes[themeIndex]) return;

      const themeObj = sortedThemes[themeIndex];
      const themeName = themeObj.theme;
      const recipes = themeObj.recettes;
      
      catContainer.style.display = "none";
      recipeDiv.style.display = "none";
      recContainer.style.display = "block";
      recContainer.innerHTML = `<h3 class="mt-3">${themeName}</h3><div class="row row-cols-1 row-cols-md-2 g-4">`;
      
      recipes.forEach((r, i) => {
        recContainer.innerHTML += ` 
          <div class="col">
            <div class="card h-100 shadow-sm">
              <img src="https://via.placeholder.com/300x160?text=${encodeURIComponent(r.titre)}" alt="${r.titre}" class="card-img-top">
              <div class="card-body">
                <h5 class="card-title">${r.titre}</h5>
                <button class="btn btn-brown" onclick="showRecipe(${themeIndex}, ${i})">Voir les détails</button>
              </div>
            </div>
          </div>`;
      });
      
      recContainer.innerHTML += `</div><div class="back-button"><button class="btn btn-brown" onclick="showCategories()">Retour aux catégories</button></div>`;
    }

    // Afficher détail recette
    function showRecipe(themeIndex, recipeIndex) {
      if (!sortedThemes[themeIndex]) return;

      const themeObj = sortedThemes[themeIndex];
      const r = themeObj.recettes[recipeIndex];
      
      recContainer.style.display = "none";
      recipeDiv.style.display = "block";
      
      let ingredientsHTML = '<h4>Ingrédients</h4>';
      if (Array.isArray(r.ingredients)) {
        ingredientsHTML += `<ul>${r.ingredients.map(ing => `<li>${ing}</li>`).join('')}</ul>`;
      }
      
      // Gérer le champ preparation (qui est un string dans votre JSON fourni)
      const preparationText = r.preparation || "Préparation non spécifiée.";

      recipeDiv.innerHTML = `
        <div class="card">
          <div class="card-body">
            <h3>${r.titre}</h3>
            <p><strong>Catégorie:</strong> ${themeObj.theme}</p>
            ${ingredientsHTML}
            <h4>Préparation</h4>
            <p>${preparationText}</p>
          </div>
        </div>
        <div class="back-button">
          <button class="btn btn-brown" onclick="showRecipes(${themeIndex})">Retour aux recettes</button>
          <button class="btn btn-brown" onclick="showCategories()">Retour aux catégories</button>
        </div>
      `;
    }
  </script>
</body>
</html>



