<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recettes - Cuisine Saine Sans Gluten et Sans Lactose</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Montserrat:wght@300;400&family=Sawarabi+Mincho&display=swap" rel="stylesheet">
  <style>
    /* Styles généraux */
    html { scroll-behavior: smooth; }
    body { font-family: 'Montserrat', sans-serif; background-color: #F0EDE5; color: #4A4A4A; margin: 0; padding: 0; background-image: linear-gradient(rgba(255,255,255,0.3), rgba(255,255,255,0.3)), url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"%3E%3Cpath fill="%236B3A1E" fill-opacity="0.05" d="M11.5 0L0 11.5V100h100V0z"/%3E%3C/svg%3E'); }
    
    /* Typographie élégante */
    h1, h3, h4 { font-family: 'Dancing Script', cursive; color: #6B3A1E; line-height: 1.2; margin: 0; padding: 10px 0; }
    h2 { font-family: 'Dancing Script', cursive; font-size: 1.6em; line-height: 2.0; letter-spacing: 0.1em; font-style: normal; font-weight: 700; color: #000000; margin: 0; text-transform: uppercase; padding: 15px 0; }
    
    /* Navigation et en-tête */
    .navbar { background-color: #8B4513 !important; padding: 10px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .navbar-brand, .nav-link { color: #F0EDE5 !important; font-weight: 300; }
    .nav-link:hover { color: #D4B483 !important; }
    header { background: linear-gradient(to bottom, #8B4513, #F0EDE5); text-align: center; padding: 30px 0; margin: 0; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    
    /* Contenu principal */
    main { padding: 20px 0; }
    .introduction, .conclusion { text-align: center; padding: 20px; font-style: italic; color: #6B3A1E; }
    
    /* Cartes de recettes/catégories (Amélioration du look) */
    .card { 
      transition: transform 0.3s ease, box-shadow 0.3s ease; 
      border: none; /* Supprimer la bordure par défaut de Bootstrap */
      border-radius: 10px;
      overflow: hidden;
    }
    .card:hover { 
      transform: translateY(-5px); /* Légère élévation */
      box-shadow: 0 10px 20px rgba(0,0,0,0.15); /* Ombre plus marquée */
    }
    .card-img-top { height: 200px; object-fit: cover; }
    .row { gap: 20px 0; padding: 0 10px; margin: 0; }
    
    /* Affichage d'une seule recette */
    #recipe-content { max-width: 800px; margin: 20px auto; padding: 30px; background-color: rgba(255,255,255,0.95); border-radius: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    
    /* Boutons bruns élégants */
    .btn-brown { 
      background-color: #6B3A1E; 
      color: #F0EDE5; 
      border: none; 
      padding: 10px 20px; 
      border-radius: 5px; 
      cursor: pointer; 
      transition: background-color 0.3s, transform 0.1s; 
      margin: 10px 5px; 
    }
    .btn-brown:hover { 
      background-color: #8B4513; 
      color: #FFF; 
      transform: translateY(-1px);
    }
    .back-button { text-align: center; padding: 20px 0; }
    
    /* Messages d'état */
    .error-message { background: #ffebee; border: 2px solid #ef5350; padding: 20px; margin: 20px auto; border-radius: 10px; text-align: center; color: #c62828; max-width: 600px; }
    .loading { text-align: center; padding: 40px; font-size: 1.2em; color: #6B3A1E; }
  </style>
</head>
<body>

  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">Cuisine Saine Sans Gluten et Sans Lactose</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Accueil</a></li>
          <li class="nav-item"><a class="nav-link" href="recettes.html">Recettes</a></li>
          <li class="nav-item"><a class="nav-link" href="fodmap.html">Méthode FODMAP</a></li>
          <li class="nav-item"><a class="nav-link" href="achats.html">Achats</a></li>
          <li class="nav-item"><a class="nav-link" href="questions.html">Questions/Commentaires</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <header>
    <h1>Nos Recettes</h1>
    <p>Sans gluten, sans lactose & sans viande rouge</p>
  </header>

  <main class="container-fluid">
    <section class="introduction">
      <p>Une collection simple de recettes riches en nutriments, faciles à préparer et adaptées aux repas quotidiens pour allier plaisir, gourmandise et santé.</p>
    </section>

        <div id="loading" class="loading">Chargement des recettes...</div>

        <div id="error-message" class="error-message" style="display: none;">
      <h3>⚠️ Erreur de chargement</h3>
      <p id="error-text">Impossible de charger le fichier de recettes. Veuillez vérifier son nom **(recettes.json)** et sa structure (doit contenir une clé `recipes` ou `themes`).</p>
    </div>

        <section id="categories-container" class="row row-cols-1 row-cols-md-2 g-4"></section>

        <section id="recipes-container" style="display: none;"></section>

        <section id="recipe-content" style="display: none;"></section>

    <section class="conclusion">
      <p>Ces recettes démontrent qu'une cuisine saine peut être élégante et gourmande. Régalez-vous !</p>
    </section>
  </main>

  <footer style="text-align: center; padding: 20px; background-color: #8B4513; color: #F0EDE5;">
    <p>&copy; 2023. Avec amour pour votre bien-être.</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Variables globales
    let groupedRecipes = {}; // Stocke les recettes regroupées par catégorie
    let categoryKeys = []; // Ordre des catégories
    
    const catContainer = document.getElementById('categories-container');
    const recContainer = document.getElementById('recipes-container');
    const recipeDiv = document.getElementById('recipe-content');
    const RECIPE_FILE = 'recettes.json'; // NOM DE FICHIER UTILISÉ

    // Fonction principale de regroupement des données
    function processData(data) {
      let recipes = [];

      // Logique pour supporter les deux structures de fichier JSON
      if (data.themes) {
        // Structure 2 : { themes: [{ theme: '...', recettes: [...] }] }
        data.themes.forEach(themeObj => {
          themeObj.recettes.forEach(recipe => {
            recipes.push({ 
              category: themeObj.theme,
              title: recipe.titre,
              ingredients: recipe.ingredients,
              preparation: recipe.preparation
            });
          });
        });
      } else if (data.recipes) {
        // Structure 1 : { recipes: [{ category: '...', title: '...', ... }] }
        recipes = data.recipes;
      } else {
        throw new Error("Structure JSON invalide. Manque les clés 'recipes' ou 'themes'.");
      }

      // Regrouper les recettes normalisées par catégorie
      groupedRecipes = recipes.reduce((acc, recipe) => {
        const category = recipe.category;
        if (!acc[category]) {
          acc[category] = [];
        }
        acc[category].push(recipe);
        return acc;
      }, {});

      categoryKeys = Object.keys(groupedRecipes).sort((a, b) => a.localeCompare(b, 'fr'));
      
      if (categoryKeys.length === 0) {
        throw new Error("Aucune recette trouvée après le traitement des données.");
      }
      
      showCategories();
    }


    // Charger le fichier JSON au chargement de la page
    document.addEventListener("DOMContentLoaded", () => {
      fetch(RECIPE_FILE)
        .then(response => {
          if (!response.ok) {
            throw new Error(`Erreur de réseau ou fichier ${RECIPE_FILE} introuvable (Code: ${response.status}).`);
          }
          return response.json();
        })
        .then(data => {
          document.getElementById('loading').style.display = 'none';
          processData(data);
        })
        .catch(error => {
          console.error('Erreur de chargement ou de traitement:', error);
          document.getElementById('loading').style.display = 'none';
          document.getElementById('error-message').style.display = 'block';
          document.getElementById('error-text').textContent = `Erreur: ${error.message}`;
        });
    });

    // Afficher catégories (Niveau 1)
    function showCategories() {
      catContainer.style.display = "flex";
      recContainer.style.display = "none";
      recipeDiv.style.display = "none";
      catContainer.innerHTML = "";
      
      categoryKeys.forEach((categoryName, index) => {
        const recipeCount = groupedRecipes[categoryName].length;
        
        // Utilisation de l'encodage pour sécuriser le passage de la catégorie dans l'attribut onclick
        const safeCategoryName = encodeURIComponent(categoryName); 

        let imageUrl = `https://via.placeholder.com/400x200?text=${encodeURIComponent(categoryName)}`;
        
        if (categoryName.includes("Desserts")) {
          imageUrl = "dessertsalle.png"; 
        } else if (categoryName.includes("Soupes")) {
          imageUrl = "soupe.jpeg"; 
        }

        catContainer.innerHTML += `
          <div class="col">
            <div class="card h-100 shadow-sm">
              <img src="${imageUrl}" class="card-img-top" alt="Image pour ${categoryName}">
              <div class="card-body text-center">
                <h5 class="card-title">${categoryName}</h5>
                <p class="text-muted">${recipeCount} recette${recipeCount > 1 ? 's' : ''}</p>
                <button class="btn btn-brown" onclick="showRecipes('${safeCategoryName}')">Voir les recettes</button>
              </div>
            </div>
          </div>`;
      });
    }

    // Afficher recettes d'un thème (Niveau 2)
    function showRecipes(encodedCategoryName) {
      // On décode la catégorie ici
      const categoryName = decodeURIComponent(encodedCategoryName);
      const recipes = groupedRecipes[categoryName];

      catContainer.style.display = "none";
      recipeDiv.style.display = "none";
      recContainer.style.display = "block";
      recContainer.innerHTML = `<h3 class="mt-3 text-center">${categoryName}</h3><div class="row row-cols-1 row-cols-md-2 g-4">`;
      
      recipes.forEach((r, i) => {
        recContainer.innerHTML += `
          <div class="col">
            <div class="card h-100 shadow-sm">
              <img src="https://via.placeholder.com/300x160?text=${encodeURIComponent(r.title)}" alt="${r.title}" class="card-img-top">
              <div class="card-body">
                <h5 class="card-title">${r.title}</h5>
                <button class="btn btn-brown" onclick="showRecipe('${encodedCategoryName}', ${i})">Voir les détails</button>
              </div>
            </div>
          </div>`;
      });
      
      recContainer.innerHTML += `</div><div class="back-button"><button class="btn btn-brown" onclick="showCategories()">Retour aux catégories</button></div>`;
    }

    // Afficher détail recette (Niveau 3)
    function showRecipe(encodedCategoryName, recipeIndex) {
      // On décode la catégorie ici
      const categoryName = decodeURIComponent(encodedCategoryName);
      const recipes = groupedRecipes[categoryName];
      const r = recipes[recipeIndex];
      
      recContainer.style.display = "none";
      recipeDiv.style.display = "block";
      
      // Formatage des ingrédients en liste
      let ingredientsHTML = '<h4>Ingrédients</h4>';
      if (Array.isArray(r.ingredients)) {
        ingredientsHTML += `<ul>${r.ingredients.map(ing => `<li>${ing}</li>`).join('')}</ul>`;
      } else if (r.ingredients) {
        ingredientsHTML += `<p>${r.ingredients}</p>`;
      }
      
      // Formatage de la préparation
      let preparationText = "Préparation non spécifiée.";
      if (Array.isArray(r.preparation)) {
        preparationText = `<ol>${r.preparation.map(step => `<li>${step}</li>`).join('')}</ol>`;
      } else if (r.preparation) {
        preparationText = `<p>${r.preparation}</p>`;
      }

      recipeDiv.innerHTML = `
        <div class="card p-4">
          <div class="card-body">
            <h3>${r.title}</h3>
            <p class="text-muted"><strong>Catégorie:</strong> ${categoryName}</p>
            ${ingredientsHTML}
            <h4>Préparation</h4>
            ${preparationText}
          </div>
        </div>
        <div class="back-button">
          <button class="btn btn-brown" onclick="showRecipes('${encodedCategoryName}')">Retour aux recettes</button>
          <button class="btn btn-brown" onclick="showCategories()">Retour aux catégories</button>
        </div>
      `;
    }
  </script>
</body>
</html>

